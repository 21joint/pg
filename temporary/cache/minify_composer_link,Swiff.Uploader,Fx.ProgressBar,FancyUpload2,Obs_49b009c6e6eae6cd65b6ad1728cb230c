(function(){var $='id'in document?document.id:window.$;ComposerNestedComment.Plugin.Link=new Class({Extends:ComposerNestedComment.Plugin.Interface,name:'link',options:{title:'Add Link',lang:{},requestOptions:{},imageMaxAspect:(10/3),imageMinAspect:(3/10),imageMinSize:48,imageMaxSize:5000,imageMinPixels:2304,imageMaxPixels:1000000,imageTimeout:5000,monitorDelay:600,debug:false},initialize:function(options){this.params=new Hash(this.params);this.parent(options);},attach:function(){this.parent();this.makeActivator();this.monitorLastContent='';this.monitorLastMatch='';this.monitorLastKeyPress=$time();this.getComposer().addEvent('editorKeyPress',function(){this.monitorLastKeyPress=$time();}.bind(this));return this;},detach:function(){this.parent();if(this.interval)
$clear(this.interval);return this;},activate:function(){if(this.active)
return;this.parent();this.makeMenu();this.makeBody();if(typeof composeInstanceComment.getForm().comment_id!='undefined'&&composeInstanceComment.getForm().comment_id.value){if($('close_edit_box-'+composeInstanceComment.getForm().comment_id.value))
$('close_edit_box-'+composeInstanceComment.getForm().comment_id.value).style.display='none';}
this.elements.formInput=new Element('input',{'id':'compose-link-form-input','class':'compose-form-input','type':'text'}).inject(this.elements.body);this.elements.formSubmit=new Element('button',{'id':'compose-link-form-submit','class':'compose-form-submit','html':this._lang('Attach'),'events':{'click':function(e){e.stop();this.doAttach();}.bind(this)}}).inject(this.elements.body);this.elements.formInput.focus();},deactivate:function(){if(!this.active)
return;this.parent();this.request=false;},poll:function(){if(this.getComposer().hasActivePlugin())
return;if($time()<this.monitorLastKeyPress+this.options.monitorDelay)
return;var content=this.getComposer().getContent();if(content==this.monitorLastContent)
return;this.monitorLastContent=content;var m=content.match(/http:\/\/([-\w\.]+)+(:\d+)?(\/([-#:\w/_\.]*(\?\S+)?)?)?/);if($type(m)&&$type(m[0])&&this.monitorLastMatch!=m[0])
{this.monitorLastMatch=m[0];this.activate();this.elements.formInput.value=this.monitorLastMatch;this.doAttach();}},doAttach:function(value){if(typeof value=='undefined'){var val=this.elements.formInput.value;}else{var val=value;}
if(!val){return;}
if(!val.match(/^[a-zA-Z]{1,5}:\/\//))
{val='http://'+val;}
this.params.set('uri',val)
if(val==''){e.stop();return;}
var options=$merge({'data':{'format':'json','uri':val},'onComplete':this.doProcessResponse.bind(this)},this.options.requestOptions);this.makeLoading('empty');if($('nested-compose-link-menu'))
$('nested-compose-link-menu').style.display='none';this.request=new Request.JSON(options);this.request.send();},doProcessResponse:function(responseJSON,responseText){if($type(responseJSON)!='object'){responseJSON={'status':false};}
this.params.set('uri',responseJSON.url);var uristr=responseJSON.url;if(uristr.substr(0,23)=='https://docs.google.com'){var title=uristr;var description='Google Document';}else{var title=responseJSON.title||responseJSON.url;var description=responseJSON.description||responseJSON.title||responseJSON.url;}
var images=responseJSON.images||[];this.params.set('title',title);this.params.set('description',description);this.params.set('images',images);this.params.set('loadedImages',[]);this.params.set('thumb','');if(images.length>0){this.doLoadImages();}else{this.doShowPreview();}},doLoadImages:function(){var interval=(function(){if(this.options.debug){console.log('Timeout reached');}
this.doShowPreview();}).delay(this.options.imageTimeout,this);this.params.loadedImages=[];this.params.set('assets',new Asset.images(this.params.get('images'),{'properties':{'class':'compose-link-image'},'onProgress':function(counter,index){this.params.loadedImages[index]=this.params.images[index];if(this.options.debug){console.log('Loaded - ',this.params.images[index]);}}.bind(this),'onError':function(counter,index){delete this.params.images[index];}.bind(this),'onComplete':function(){$clear(interval);this.doShowPreview();}.bind(this)}));},doShowPreview:function(){var self=this;this.elements.body.empty();this.makeFormInputs();if(this.params.loadedImages.length>0){var tmp=new Array();this.elements.previewImages=new Element('div',{'id':'compose-link-preview-images','class':'compose-preview-images'}).inject(this.elements.body);this.params.assets.each(function(element,index){if(!$type(this.params.loadedImages[index]))
return;element.addClass('compose-preview-image-invisible').inject(this.elements.previewImages);if(!this.checkImageValid(element)){delete this.params.images[index];delete this.params.loadedImages[index];element.destroy();}else{element.removeClass('compose-preview-image-invisible').addClass('compose-preview-image-hidden');tmp.push(this.params.loadedImages[index]);element.erase('height');element.erase('width');}}.bind(this));this.params.loadedImages=tmp;if(this.params.loadedImages.length<=0){this.elements.previewImages.destroy();}}
this.elements.previewInfo=new Element('div',{'id':'compose-link-preview-info','class':'compose-preview-info'}).inject(this.elements.body);this.elements.previewTitle=new Element('div',{'id':'compose-link-preview-title','class':'compose-preview-title'}).inject(this.elements.previewInfo);this.elements.previewTitleLink=new Element('a',{'href':this.params.uri,'html':this.params.title,'events':{'click':function(e){e.stop();self.handleEditTitle(this);}}}).inject(this.elements.previewTitle);this.elements.previewDescription=new Element('div',{'id':'compose-link-preview-description','class':'compose-preview-description','html':this.params.description,'events':{'click':function(e){e.stop();self.handleEditDescription(this);}}}).inject(this.elements.previewInfo);if(this.params.loadedImages.length>0){this.elements.previewOptions=new Element('div',{'id':'compose-link-preview-options','class':'compose-preview-options'}).inject(this.elements.previewInfo);if(this.params.loadedImages.length>1){this.elements.previewChoose=new Element('div',{'id':'compose-link-preview-options-choose','class':'compose-preview-options-choose','html':'<span>'+this._lang('Choose Image:')+'</span>'}).inject(this.elements.previewOptions);this.elements.previewPrevious=new Element('a',{'id':'compose-link-preview-options-previous','class':'compose-preview-options-previous','href':'javascript:void(0);','html':'&#171; '+this._lang('Last'),'events':{'click':this.doSelectImagePrevious.bind(this)}}).inject(this.elements.previewChoose);this.elements.previewCount=new Element('span',{'id':'compose-link-preview-options-count','class':'compose-preview-options-count'}).inject(this.elements.previewChoose);this.elements.previewPrevious=new Element('a',{'id':'compose-link-preview-options-next','class':'compose-preview-options-next','href':'javascript:void(0);','html':this._lang('Next')+' &#187;','events':{'click':this.doSelectImageNext.bind(this)}}).inject(this.elements.previewChoose);}
this.elements.previewNoImage=new Element('div',{'id':'compose-link-preview-options-none','class':'compose-preview-options-none'}).inject(this.elements.previewOptions);this.elements.previewNoImageInput=new Element('input',{'id':'compose-link-preview-options-none-input','class':'compose-preview-options-none-input','type':'checkbox','events':{'click':this.doToggleNoImage.bind(this)}}).inject(this.elements.previewNoImage);this.elements.previewNoImageLabel=new Element('label',{'for':'compose-link-preview-options-none-input','html':this._lang('Don\'t show an image'),'events':{}}).inject(this.elements.previewNoImage);this.setImageThumb(this.elements.previewImages.getChildren()[0]);}
if($('nested-compose-link-menu'))
$('nested-compose-link-menu').style.display='block';},checkImageValid:function(element){var size=element.getSize();var sizeAlt={x:element.get('width'),y:element.get('height')};var width=sizeAlt.x||size.x;var height=sizeAlt.y||size.y;var pixels=width*height;var aspect=width/height;if(this.options.debug){console.log(element.get('src'),sizeAlt,size,width,height,pixels,aspect);}
if(aspect>this.options.imageMaxAspect){if(this.options.debug){console.log('Aspect greater than max - ',element.get('src'),aspect,this.options.imageMaxAspect);}
return false;}else if(aspect<this.options.imageMinAspect){if(this.options.debug){console.log('Aspect less than min - ',element.get('src'),aspect,this.options.imageMinAspect);}
return false;}
if(width<this.options.imageMinSize){if(this.options.debug){console.log('Width less than min - ',element.get('src'),width,this.options.imageMinSize);}
return false;}else if(height<this.options.imageMinSize){if(this.options.debug){console.log('Height less than min - ',element.get('src'),height,this.options.imageMinSize);}
return false;}
if(width>this.options.imageMaxSize){if(this.options.debug){console.log('Width greater than max - ',element.get('src'),width,this.options.imageMaxSize);}
return false;}else if(height>this.options.imageMaxSize){if(this.options.debug){console.log('Height greater than max - ',element.get('src'),height,this.options.imageMaxSize);}
return false;}
if(pixels<this.options.imageMinPixels){if(this.options.debug){console.log('Pixel count less than min - ',element.get('src'),pixels,this.options.imageMinPixels);}
return false;}else if(pixels>this.options.imageMaxPixels){if(this.options.debug){console.log('Pixel count greater than max - ',element.get('src'),pixels,this.options.imageMaxPixels);}
return false;}
return true;},doSelectImagePrevious:function(){if(this.elements.imageThumb&&this.elements.imageThumb.getPrevious()){this.setImageThumb(this.elements.imageThumb.getPrevious());}},doSelectImageNext:function(){if(this.elements.imageThumb&&this.elements.imageThumb.getNext()){this.setImageThumb(this.elements.imageThumb.getNext());}},doToggleNoImage:function(){if(!$type(this.params.thumb)){this.params.thumb=this.elements.imageThumb.src;this.setFormInputValue('thumb',this.params.thumb);this.elements.previewImages.setStyle('display','');if(this.elements.previewChoose)
this.elements.previewChoose.setStyle('display','');}else{delete this.params.thumb;this.setFormInputValue('thumb','');this.elements.previewImages.setStyle('display','none');if(this.elements.previewChoose)
this.elements.previewChoose.setStyle('display','none');}},setImageThumb:function(element){if(this.elements.imageThumb){this.elements.imageThumb.addClass('compose-preview-image-hidden');}
if(element){element.removeClass('compose-preview-image-hidden');this.elements.imageThumb=element;this.params.thumb=element.src;this.setFormInputValue('thumb',element.src);if(this.elements.previewCount){var index=this.params.loadedImages.indexOf(element.src);this.elements.previewCount.set('html',' | '+this._lang('%d of %d',index+1,this.params.loadedImages.length)+' | ');}}else{this.elements.imageThumb=false;delete this.params.thumb;}},makeFormInputs:function(){this.ready();this.parent({'uri':this.params.uri,'title':this.params.title,'description':this.params.description,'thumb':this.params.thumb});},handleEditTitle:function(element){element.setStyle('display','none');var input=new Element('input',{'type':'text','value':element.get('text').trim(),'events':{'blur':function(){if(input.value.trim()!=''){this.params.title=input.value;element.set('text',this.params.title);this.setFormInputValue('title',this.params.title);}
element.setStyle('display','');input.destroy();}.bind(this)}}).inject(element,'after');input.focus();},handleEditDescription:function(element){element.setStyle('display','none');var input=new Element('textarea',{'html':element.get('text').trim(),'events':{'blur':function(){if(input.value.trim()!=''){this.params.description=input.value;element.set('text',this.params.description);this.setFormInputValue('description',this.params.description);}
element.setStyle('display','');input.destroy();}.bind(this)}}).inject(element,'after');input.focus();}});})();;Swiff.Uploader=new Class({Extends:Swiff,Implements:Events,options:{path:'Swiff.Uploader.swf',target:null,zIndex:9999,height:30,width:100,callBacks:null,params:{wMode:'opaque',menu:'false',allowScriptAccess:'always'},typeFilter:null,multiple:true,queued:true,verbose:false,url:null,method:null,data:null,mergeData:true,fieldName:null,fileSizeMin:1,fileSizeMax:null,allowDuplicates:false,timeLimit:(Browser.Platform.linux)?0:30,buttonImage:null,policyFile:null,fileListMax:0,fileListSizeMax:0,instantStart:false,appendCookieData:false,fileClass:null},initialize:function(options){this.addEvent('load',this.initializeSwiff,true).addEvent('select',this.processFiles,true).addEvent('complete',this.update,true).addEvent('fileRemove',function(file){this.fileList.erase(file);}.bind(this),true);this.setOptions(options);if(this.options.callBacks){Hash.each(this.options.callBacks,function(fn,name){this.addEvent(name,fn);},this);}
this.options.callBacks={fireCallback:this.fireCallback.bind(this)};var path=this.options.path;if(!path.contains('?'))path+='?noCache='+$time();this.options.container=this.box=new Element('span',{'class':'swiff-uploader-box'}).inject($(this.options.container)||document.body);this.target=$(this.options.target);if(this.target){var scroll=window.getScroll();this.box.setStyles({position:'absolute',visibility:'visible',zIndex:this.options.zIndex,overflow:'hidden',height:1,width:1,top:scroll.y,left:scroll.x});this.parent(path,{params:{wMode:'transparent'},height:'100%',width:'100%'});this.target.addEvent('mouseenter',this.reposition.bind(this,[]));this.addEvents({buttonEnter:this.targetRelay.bind(this,['mouseenter']),buttonLeave:this.targetRelay.bind(this,['mouseleave']),buttonDown:this.targetRelay.bind(this,['mousedown']),buttonDisable:this.targetRelay.bind(this,['disable'])});this.reposition();window.addEvent('resize',this.reposition.bind(this,[]));}else{this.parent(path);}
this.inject(this.box);this.fileList=[];this.size=this.uploading=this.bytesLoaded=this.percentLoaded=0;if(Browser.Plugins.Flash.version<9){this.fireEvent('fail',['flash']);}else{this.verifyLoad.delay(1000,this);}},verifyLoad:function(){if(this.loaded)return;if(!this.object.parentNode){this.fireEvent('fail',['disabled']);}else if(this.object.style.display=='none'){this.fireEvent('fail',['hidden']);}else if(!this.object.offsetWidth){this.fireEvent('fail',['empty']);}},fireCallback:function(name,args){if(name.substr(0,4)=='file'){if(args.length>1)this.update(args[1]);var data=args[0];var file=this.findFile(data.id);this.fireEvent(name,file||data,5);if(file){var fire=name.replace(/^file([A-Z])/,function($0,$1){return $1.toLowerCase();});file.update(data).fireEvent(fire,[data],10);}}else{this.fireEvent(name,args,5);}},update:function(data){$extend(this,data);this.fireEvent('queue',[this],10);return this;},findFile:function(id){for(var i=0;i<this.fileList.length;i++){if(this.fileList[i].id==id)return this.fileList[i];}
return null;},initializeSwiff:function(){this.remote('initialize',{width:this.options.width,height:this.options.height,typeFilter:this.options.typeFilter,multiple:this.options.multiple,queued:this.options.queued,url:this.options.url,method:this.options.method,data:this.options.data,mergeData:this.options.mergeData,fieldName:this.options.fieldName,verbose:this.options.verbose,fileSizeMin:this.options.fileSizeMin,fileSizeMax:this.options.fileSizeMax,allowDuplicates:this.options.allowDuplicates,timeLimit:this.options.timeLimit,buttonImage:this.options.buttonImage,policyFile:this.options.policyFile});this.loaded=true;this.appendCookieData();},targetRelay:function(name){if(this.target)this.target.fireEvent(name);},reposition:function(coords){if($type(coords)=='array'&&coords.length==0){coords=null;}
coords=coords||((this.target&&this.target.offsetHeight)?this.target.getCoordinates():{top:window.getScrollTop(),left:0,width:40,height:40})
if('right'in coords&&(Browser.Engine.webkit||Browser.Engine.trident)&&$try(function(){return $$('html')[0].get('dir')=='rtl'})){coords.right=$$('body')[0].getComputedSize().x-coords.right;}
this.box.setStyles(coords);this.fireEvent('reposition',[coords,this.box,this.target]);},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);if(options.buttonImage)options.buttonImage=Swiff.Uploader.qualifyPath(options.buttonImage);this.parent(options);if(this.loaded)this.remote('setOptions',options);}
return this;},setEnabled:function(status){this.remote('setEnabled',status);},start:function(){this.fireEvent('beforeStart');this.remote('UploadStart');},stop:function(){this.fireEvent('beforeStop');this.remote('UploadStop');},remove:function(){this.fireEvent('beforeRemove');this.remote('remove');},fileStart:function(file){this.remote('fileStart',file.id);},fileStop:function(file){this.remote('fileStop',file.id);},fileRemove:function(file){this.remote('fileRemove',file.id);},fileRequeue:function(file){this.remote('fileRequeue',file.id);},appendCookieData:function(){var append=this.options.appendCookieData;if(!append)return;var hash={};document.cookie.split(/;\s*/).each(function(cookie){cookie=cookie.split('=');if(cookie.length==2){hash[decodeURIComponent(cookie[0])]=decodeURIComponent(cookie[1]);}});var data=this.options.data||{};if($type(append)=='string')data[append]=hash;else $extend(data,hash);this.setOptions({data:data});},processFiles:function(successraw,failraw,queue){var cls=this.options.fileClass||Swiff.Uploader.File;var fail=[],success=[];if(successraw){successraw.each(function(data){var ret=new cls(this,data);if(!ret.validate()){ret.remove.delay(10,ret);fail.push(ret);}else{this.size+=data.size;this.fileList.push(ret);success.push(ret);ret.render();}},this);this.fireEvent('selectSuccess',[success],10);}
if(failraw||fail.length){fail.extend((failraw)?failraw.map(function(data){return new cls(this,data);},this):[]).each(function(file){file.invalidate().render();});this.fireEvent('selectFail',[fail],10);}
this.update(queue);if(this.options.instantStart&&success.length)this.start();}});$extend(Swiff.Uploader,{STATUS_QUEUED:0,STATUS_RUNNING:1,STATUS_ERROR:2,STATUS_COMPLETE:3,STATUS_STOPPED:4,log:function(){if(window.console&&console.info)console.info.apply(console,arguments);},unitLabels:{b:[{min:1,unit:'B'},{min:1024,unit:'kB'},{min:1048576,unit:'MB'},{min:1073741824,unit:'GB'}],s:[{min:1,unit:'s'},{min:60,unit:'m'},{min:3600,unit:'h'},{min:86400,unit:'d'}]},formatUnit:function(base,type,join){var labels=Swiff.Uploader.unitLabels[(type=='bps')?'b':type];var append=(type=='bps')?'/s':'';var i,l=labels.length,value;if(base<1)return'0 '+labels[0].unit+append;if(type=='s'){var units=[];for(i=l-1;i>=0;i--){value=Math.floor(base/labels[i].min);if(value){units.push(value+' '+labels[i].unit);base-=value*labels[i].min;if(!base)break;}}
return(join===false)?units:units.join(join||', ');}
for(i=l-1;i>=0;i--){value=labels[i].min;if(base>=value)break;}
return(base/value).toFixed(1)+' '+labels[i].unit+append;}});Swiff.Uploader.qualifyPath=(function(){var anchor;return function(path){(anchor||(anchor=new Element('a'))).href=path;return anchor.href;};})();Swiff.Uploader.File=new Class({Implements:Events,initialize:function(base,data){this.base=base;this.update(data);},update:function(data){return $extend(this,data);},validate:function(){var options=this.base.options;if(options.fileListMax&&this.base.fileList.length>=options.fileListMax){this.validationError='fileListMax';return false;}
if(options.fileListSizeMax&&(this.base.size+this.size)>options.fileListSizeMax){this.validationError='fileListSizeMax';return false;}
return true;},invalidate:function(){this.invalid=true;this.base.fireEvent('fileInvalid',this,10);return this.fireEvent('invalid',this,10);},render:function(){return this;},setOptions:function(options){if(options){if(options.url)options.url=Swiff.Uploader.qualifyPath(options.url);this.base.remote('fileSetOptions',this.id,options);this.options=$merge(this.options,options);}
return this;},start:function(){this.base.fileStart(this);return this;},stop:function(){this.base.fileStop(this);return this;},remove:function(){this.base.fileRemove(this);return this;},requeue:function(){this.base.fileRequeue(this);}});;Fx.ProgressBar=new Class({Extends:Fx,options:{text:null,url:null,transition:Fx.Transitions.Circ.easeOut,fit:true,link:'cancel'},initialize:function(element,options){this.element=$(element);this.parent(options);var url=this.options.url;if(url){this.element.setStyles({'background-image':'url('+url+')','background-repeat':'no-repeat'});}
if(this.options.fit){url=url||this.element.getStyle('background-image').replace(/^url\(["']?|["']?\)$/g,'');if(url){var fill=new Image();fill.onload=function(){this.fill=fill.width;fill=fill.onload=null;this.set(this.now||0);}.bind(this);fill.src=url;if(!this.fill&&fill.width)fill.onload();}}else{this.set(0);}},start:function(to,total){return this.parent(this.now,(arguments.length==1)?to.limit(0,100):to/total*100);},set:function(to){this.now=to;var css=(this.fill)?(((this.fill/-2)+(to/100)*(this.element.width||1)||0).round()+'px'):((100-to)+'%');this.element.setStyle('backgroundPosition',css+' 0px').title=Math.round(to)+'%';var text=$(this.options.text);if(text)text.set('text',Math.round(to)+'%');return this;}});;var FancyUpload2=new Class({Extends:Swiff.Uploader,options:{queued:1,limitSize:0,limitFiles:0,validateFile:$lambda(true)},initialize:function(status,list,options){this.status=$(status);this.list=$(list);options.fileClass=options.fileClass||FancyUpload2.File;options.fileSizeMax=options.limitSize||options.fileSizeMax;options.fileListMax=options.limitFiles||options.fileListMax;this.parent(options);this.addEvents({'load':this.render,'select':this.onSelect,'cancel':this.onCancel,'start':this.onStart,'queue':this.onQueue,'complete':this.onComplete});},render:function(){this.overallTitle=this.status.getElement('.overall-title');this.currentTitle=this.status.getElement('.current-title');this.currentText=this.status.getElement('.current-text');var progress=this.status.getElement('.overall-progress');this.overallProgress=new Fx.ProgressBar(progress,{text:new Element('span',{'class':'progress-text'}).inject(progress,'after')});progress=this.status.getElement('.current-progress')
this.currentProgress=new Fx.ProgressBar(progress,{text:new Element('span',{'class':'progress-text'}).inject(progress,'after')});this.updateOverall();},onSelect:function(){this.status.removeClass('status-browsing');},onCancel:function(){this.status.removeClass('file-browsing');},onStart:function(){this.status.addClass('file-uploading');this.overallProgress.set(0);},onQueue:function(){this.updateOverall();},onComplete:function(){this.status.removeClass('file-uploading');if(this.size){this.overallProgress.start(100);}else{this.overallProgress.set(0);this.currentProgress.set(0);}},updateOverall:function(){this.overallTitle.set('html',MooTools.lang.get('FancyUpload','progressOverall').substitute({total:Swiff.Uploader.formatUnit(this.size,'b')}));if(!this.size){this.currentTitle.set('html',MooTools.lang.get('FancyUpload','currentTitle'));this.currentText.set('html','');}},upload:function(){this.start();},removeFile:function(){return this.remove();}});FancyUpload2.File=new Class({Extends:Swiff.Uploader.File,render:function(){if(this.invalid){if(this.validationError){var msg=MooTools.lang.get('FancyUpload','validationErrors')[this.validationError]||this.validationError;this.validationErrorMessage=msg.substitute({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b'),fileSizeMin:Swiff.Uploader.formatUnit(this.base.options.fileSizeMin||0,'b'),fileSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileSizeMax||0,'b'),fileListMax:this.base.options.fileListMax||0,fileListSizeMax:Swiff.Uploader.formatUnit(this.base.options.fileListSizeMax||0,'b')});}
this.remove();return;}
this.addEvents({'start':this.onStart,'progress':this.onProgress,'complete':this.onComplete,'error':this.onError,'remove':this.onRemove});this.info=new Element('span',{'class':'file-info'});this.element=new Element('li',{'class':'file'}).adopt(new Element('span',{'class':'file-size','html':Swiff.Uploader.formatUnit(this.size,'b')}),new Element('a',{'class':'file-remove',href:'#',html:MooTools.lang.get('FancyUpload','remove'),title:MooTools.lang.get('FancyUpload','removeTitle'),events:{click:function(){this.remove();return false;}.bind(this)}}),new Element('span',{'class':'file-name','html':MooTools.lang.get('FancyUpload','fileName').substitute(this)}),this.info).inject(this.base.list);},validate:function(){return(this.parent()&&this.base.options.validateFile(this));},onStart:function(){this.element.addClass('file-uploading');this.base.currentProgress.cancel().set(0);this.base.currentTitle.set('html',MooTools.lang.get('FancyUpload','currentFile').substitute(this));},onProgress:function(){this.base.overallProgress.start(this.base.percentLoaded);this.base.currentText.set('html',MooTools.lang.get('FancyUpload','currentProgress').substitute({rate:(this.progress.rate)?Swiff.Uploader.formatUnit(this.progress.rate,'bps'):'- B',bytesLoaded:Swiff.Uploader.formatUnit(this.progress.bytesLoaded,'b'),timeRemaining:(this.progress.timeRemaining)?Swiff.Uploader.formatUnit(this.progress.timeRemaining,'s'):'-'}));this.base.currentProgress.start(this.progress.percentLoaded);},onComplete:function(){this.element.removeClass('file-uploading');this.base.currentText.set('html','Upload completed');this.base.currentProgress.start(100);if(this.response.error){var msg=MooTools.lang.get('FancyUpload','errors')[this.response.error]||'{error} #{code}';this.errorMessage=msg.substitute($extend({name:this.name,size:Swiff.Uploader.formatUnit(this.size,'b')},this.response));var args=[this,this.errorMessage,this.response];this.fireEvent('error',args).base.fireEvent('fileError',args);}else{this.base.fireEvent('fileSuccess',[this,this.response.text||'']);}},onError:function(){this.element.addClass('file-failed');var error=MooTools.lang.get('FancyUpload','fileError').substitute(this);this.info.set('html','<strong>'+error+':</strong> '+this.errorMessage);},onRemove:function(){this.element.getElements('a').setStyle('visibility','hidden');this.element.fade('out').retrieve('tween').chain(Element.destroy.bind(Element,this.element));}});(function(){var phrases={'progressOverall':'Overall Progress ({total})','currentTitle':'File Progress','currentFile':'Uploading "{name}"','currentProgress':'Upload: {bytesLoaded} with {rate}, {timeRemaining} remaining.','fileName':'{name}','remove':'Remove','removeTitle':'Click to remove this entry.','fileError':'Upload failed','validationErrors':{'duplicate':'{name} already added.','sizeLimitMin':'{name} ({size}) is too small, the minimal file size is {fileSizeMin}.','sizeLimitMax':'{name} ({size}) is too big, the maximal file size is {fileSizeMax}.','fileListMax':'{name} could not be added, amount of {fileListMax} files exceeded.','fileListSizeMax':'{name} ({size}) is too big, overall filesize of {fileListSizeMax} exceeded.'},'errors':{'httpStatus':'Server returned HTTP-Status <code>#{code}</code>','securityError':'Security error occurred ({text})','ioError':'Error caused a send or load operation to fail ({text})'}};if(('en4'in window)&&$type(en4)&&$type(en4.core.language)){$H(phrases).each(function(value,key){if($type(value)=='string'){phrases[key]=en4.core.language.translate(value);}else if($type(value)=='object'){$H(value).each(function(pvalue,pkey){if($type(value)=='string'){phrases[key][pkey]=en4.core.language.translate(pvalue);}});}});}
if(MooTools.lang){MooTools.lang.set('en-US','FancyUpload',phrases);}else{MooTools.lang={data:{'FancyUpload':phrases},get:function(from,key){return this.data[from][key];},set:function(locale,from,data){data[from]=data;}};}})();;var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(el,onFired,options){this.element=$(el)||$$(el);this.addEvent('onFired',onFired);this.setOptions(options);this.bound=this.changed.bind(this);this.resume();},changed:function(){var value=this.element.get('value');if($equals(this.value,value))return;this.clear();this.value=value;this.timeout=this.onFired.delay(this.options.delay,this);},setValue:function(value){this.value=value;this.element.set('value',value);return this.clear();},onFired:function(){this.fireEvent('onFired',[this.value,this.element]);},clear:function(){$clear(this.timeout||null);return this;},pause:function(){if(this.timer)$clear(this.timer);else this.element.removeEvent('keyup',this.bound);return this.clear();},resume:function(){this.value=this.element.get('value');if(this.options.periodical)this.timer=this.changed.periodical(this.options.periodical,this);else this.element.addEvent('keyup',this.bound);return this;}});var $equals=function(obj1,obj2){return(obj1==obj2||JSON.encode(obj1)==JSON.encode(obj2));};